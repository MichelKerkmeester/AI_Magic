# =============================================================================
# ⚠️  DEPRECATED - Documentation Only, Not Enforced at Runtime
# =============================================================================
# Replacement: context-inference.sh (CAPS - Context-Aware Permission System)
# Migration Guide: See specs/014-context-aware-permission-system/
# Removal Date: 2025-02-01
#
# This schema is kept for reference only. The actual agent format used by
# .agents/registry.yaml differs from this schema. CAPS infers permissions
# from context rather than explicit registration.
# =============================================================================

# =============================================================================
# Agent Registration Schema (LEGACY)
# =============================================================================
# Defines the structure for registering and tracking parallel agents
# in the multi-agent orchestration system.
#
# Version: 1.0.0
# Tasks: T001, T018
# =============================================================================

schema:
  name: AgentRegistration
  version: "1.0.0"
  description: "Schema for parallel agent registration and state tracking"

# -----------------------------------------------------------------------------
# Field Definitions
# -----------------------------------------------------------------------------
fields:

  # ---------------------------------------------------------------------------
  # agent_id
  # ---------------------------------------------------------------------------
  # Unique identifier for each agent instance
  # Format: {role}-{session_prefix}-{sequence}
  # Example: "code-abc123-001"
  agent_id:
    type: string
    required: true
    unique: true
    pattern: "^[a-z]+-[a-z0-9]+-[0-9]{3}$"
    description: "Unique identifier for the agent instance"
    example: "code-abc123-001"

  # ---------------------------------------------------------------------------
  # role
  # ---------------------------------------------------------------------------
  # The functional role this agent performs in the system
  # Each role has specific capabilities and responsibilities
  role:
    type: string
    required: true
    enum:
      - orchestrator  # Coordinates other agents, manages workflow
      - code          # Writes and modifies source code
      - docs          # Creates and updates documentation
      - test          # Writes tests and validates functionality
      - debug         # Investigates issues and fixes bugs
      - research      # Gathers information and analyzes patterns
    description: "Functional role defining agent responsibilities"
    example: "code"

  # ---------------------------------------------------------------------------
  # capabilities
  # ---------------------------------------------------------------------------
  # Array of specific actions this agent can perform
  # Used for task routing and capability matching
  capabilities:
    type: array
    items:
      type: string
    required: true
    min_items: 1
    description: "List of specific capabilities the agent possesses"
    examples:
      orchestrator:
        - "dispatch_agents"
        - "aggregate_results"
        - "manage_checkpoints"
        - "resolve_conflicts"
      code:
        - "read_files"
        - "write_files"
        - "refactor_code"
        - "implement_features"
      docs:
        - "write_markdown"
        - "create_specs"
        - "update_readme"
        - "generate_diagrams"
      test:
        - "write_unit_tests"
        - "run_test_suites"
        - "validate_coverage"
        - "create_fixtures"
      debug:
        - "analyze_errors"
        - "trace_execution"
        - "fix_bugs"
        - "profile_performance"
      research:
        - "semantic_search"
        - "analyze_patterns"
        - "gather_context"
        - "compare_approaches"

  # ---------------------------------------------------------------------------
  # status
  # ---------------------------------------------------------------------------
  # Current operational state of the agent
  # Transitions: idle -> active -> busy -> (idle|terminated)
  status:
    type: string
    required: true
    default: "idle"
    enum:
      - active      # Agent is running and ready to receive tasks
      - idle        # Agent is registered but not actively working
      - busy        # Agent is currently processing a task
      - terminated  # Agent has completed or been stopped
    description: "Current operational state of the agent"
    example: "active"

  # ---------------------------------------------------------------------------
  # priority
  # ---------------------------------------------------------------------------
  # Task priority level for scheduling and resource allocation
  # P0 = Critical (blocks others), P1 = High, P2 = Normal
  priority:
    type: string
    required: true
    default: "P1"
    enum:
      - P0  # Critical - highest priority, may preempt others
      - P1  # High - important tasks, standard priority
      - P2  # Normal - background or lower priority tasks
    description: "Priority level for task scheduling"
    example: "P1"

  # ---------------------------------------------------------------------------
  # session_id
  # ---------------------------------------------------------------------------
  # Links agent to a specific orchestration session
  # Optional - may be null for unassigned agents
  session_id:
    type: string
    required: false
    nullable: true
    pattern: "^sess-[a-z0-9]{8}$"
    description: "Current session this agent is assigned to"
    example: "sess-abc12345"

  # ---------------------------------------------------------------------------
  # created_at
  # ---------------------------------------------------------------------------
  # Timestamp when the agent was first registered
  # ISO 8601 format with timezone
  created_at:
    type: string
    format: iso8601
    required: true
    immutable: true
    description: "Timestamp of agent registration"
    example: "2025-01-15T14:30:00Z"

  # ---------------------------------------------------------------------------
  # updated_at
  # ---------------------------------------------------------------------------
  # Timestamp of last state change or update
  # Automatically updated on any field modification
  updated_at:
    type: string
    format: iso8601
    required: true
    auto_update: true
    description: "Timestamp of last agent state change"
    example: "2025-01-15T14:35:22Z"

  # ---------------------------------------------------------------------------
  # metadata
  # ---------------------------------------------------------------------------
  # Extensible properties for agent-specific data
  # Schema-free to allow role-specific extensions
  metadata:
    type: object
    required: false
    nullable: true
    description: "Extensible properties for agent-specific data"
    example:
      task_count: 5
      last_task_id: "T018"
      workspace_path: "/path/to/workspace"
      error_count: 0

# -----------------------------------------------------------------------------
# Validation Rules
# -----------------------------------------------------------------------------
validation:
  # Ensure agent_id follows naming convention
  - rule: "agent_id must match pattern {role}-{prefix}-{seq}"
    field: agent_id
    
  # Ensure capabilities array is not empty
  - rule: "capabilities must contain at least one item"
    field: capabilities
    
  # Ensure timestamps are valid ISO 8601
  - rule: "timestamps must be valid ISO 8601 format"
    fields: [created_at, updated_at]

# -----------------------------------------------------------------------------
# Example Agent Registration
# -----------------------------------------------------------------------------
example:
  agent_id: "code-abc123-001"
  role: "code"
  capabilities:
    - "read_files"
    - "write_files"
    - "refactor_code"
  status: "active"
  priority: "P1"
  session_id: "sess-abc12345"
  created_at: "2025-01-15T14:30:00Z"
  updated_at: "2025-01-15T14:35:22Z"
  metadata:
    task_count: 3
    workspace_path: "/Users/YOUR_NAME/project"
