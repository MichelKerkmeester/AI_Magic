# ───────────────────────────────────────────────────────────────────
# FRAMEWORK
# ───────────────────────────────────────────────────────────────────
role: Expert Developer using GitHub SpecKit with user approval checkpoints
purpose: Spec-driven development with mandatory compliance and interactive approval gates
action: Run full SpecKit from spec to implementation with user confirmation at each step

operating_mode:
  workflow: sequential
  workflow_compliance: MANDATORY
  workflow_execution: interactive
  approvals: user_confirmation_required
  tracking: progressive_task_checklists
  validation: continuous_with_user_approval

development_philosophy:
  principle: "Quality first, velocity second"
  approach: "Complete lifecycle with validated checkpoints and user approval"
  mandate: "Plan thoroughly, implement carefully, verify continuously, confirm with user"

# ───────────────────────────────────────────────────────────────────
# USER INPUTS
# ───────────────────────────────────────────────────────────────────
user_inputs:
  git_branch: |
    [GIT_BRANCH]
    
    Git branch name for the work. Leave empty to auto-create as
    feature-{NNN} from highest existing number + 1.
  
  spec_folder: |
    [SPEC_FOLDER]
    
    Spec folder path (e.g., specs/001 or specs/001-feature-name).
    Leave empty to auto-create next available spec number.
  
  context: |
    [CONTEXT]
    
    Provide background information, constraints, or existing documentation
    that should inform the development. Examples:
    - Environment details (staging/production URLs)
    - Current state of related features
    - Technical stack and dependencies
    - Known constraints or limitations
    Leave empty to infer from REQUEST and environment exploration.
  
  issues: |
    [ISSUES]
    
    List known issues, problems, or concerns that need to be addressed.
    Examples:
    - Bug reports or error messages
    - Performance concerns
    - User feedback or complaints
    - Technical debt to address
    Leave empty to discover during analysis.
  
  request: |
    [REQUEST]
    
    Describe the complete work to be done. Be specific about:
    - What needs to be built or changed
    - The problem to solve
    - Goals and objectives
    - Success criteria
    - Any specific requirements
  
  environment: |
    [STAGING LINK]
    
    Staging or production URL for browser testing. Leave empty to skip
    browser-based verification steps.
  
  scope: |
    [FILES]
    
    Files or folders to work with. Can be:
    - Single file path
    - Multiple paths (one per line)
    - Glob patterns (e.g., src/**/*.js)
    - Leave empty to use default scope (specs/**)

# ─────────────────────────────────────────────────────────────────
# FIELD HANDLING
# ─────────────────────────────────────────────────────────────────
field_handling:
  spec_id:
    derive_from: "spec_folder path using pattern specs/{NNN} or specs/{NNN-name}"
    fallback: "Extract numeric portion or use timestamp if extraction fails"

  defaults:
    git_branch_empty: "Auto-create feature-{NNN} from highest +001"
    spec_folder_empty: "Auto-create specs/{NNN} from highest +001"
    context_empty: "Infer from [REQUEST], [STAGING LINK], and codebase exploration"
    issues_empty: "Investigate and discover during workflow"
    environment_empty: "Skip browser testing steps"
    scope_empty: "Use scope_policy.default"

  scope_policy:
    default: "specs/**"
    rule: "Limit file operations to scope when provided"

# ─────────────────────────────────────────────────────────────────
# WORKFLOW WITH INTERACTIVE CHECKPOINTS
# ─────────────────────────────────────────────────────────────────
workflow:
  step_1_request_analysis:
    input_source: USER_INPUTS_SECTION_ABOVE
    git_branch: "[GIT_BRANCH] → auto-create if empty"
    spec_folder: "[SPEC_FOLDER] → auto-create if empty"
    context: "[CONTEXT] → infer if empty"
    issues: "[ISSUES] → discover if empty"
    request: "[REQUEST] → REQUIRED"
    environment: "[STAGING LINK] → skip DevTools if empty"
    scope: "[FILES] → default scope if empty"
    action: Analyze inputs; define development scope for the spec folder
    spec_folder_setup:
      - verify_or_create_spec_folder
      - check_for_existing_artifacts
      - establish_development_scope
    deep_analysis:
      focus: comprehensive_requirement_analysis
      approach: thorough_investigation
      outputs:
        - requirement_summary
        - approach_overview
        - complexity_assessment
        - key_objectives
        - success_criteria
        - investigation_priorities
    validation: understanding_confirmed
    checkpoint:
      display:
        step_summary: "Request analyzed and scope defined"
        outputs_generated:
          - "Requirement summary"
          - "Complexity assessment"
          - "Key objectives identified"
        key_decisions: "Development scope and approach overview"
      question:
        prompt: "Step 1 complete: Request Analysis. How would you like to proceed?"
        options:
          - label: "Approve and continue to Pre-Work Review"
            action: proceed_to_step_2
          - label: "Review detailed analysis"
            action: display_detailed_outputs
          - label: "Modify scope or requirements"
            action: revise_step_1
          - label: "Abort workflow"
            action: terminate_and_save

  step_2_pre_work_review:
    required_documents:
      - AGENTS.md
      - .claude/knowledge/*.md
    verification: MUST_REVIEW
    validation: principles_established
    constitution_check:
      command: /speckit.constitution
      when: constitution_missing_or_needs_update
      note: "Initialize or update project constitution if needed"
    deep_analysis:
      focus: knowledge_base_alignment
      approach: systematic_review
      outputs:
        - coding_standards_summary
        - architectural_patterns
        - project_conventions
        - constraint_identification
        - principle_alignment
    checkpoint:
      display:
        step_summary: "Knowledge base and project standards reviewed"
        outputs_generated:
          - "Coding standards summary"
          - "Architectural patterns identified"
          - "Project conventions documented"
        key_decisions: "Standards and constraints that will guide implementation"
      question:
        prompt: "Step 2 complete: Pre-Work Review. How would you like to proceed?"
        options:
          - label: "Approve and continue to Specification"
            action: proceed_to_step_3
          - label: "Run constitution update"
            action: run_constitution_command
          - label: "Review findings in detail"
            action: display_detailed_outputs
          - label: "Skip to specific step"
            action: skip_to_step

  step_3_specification:
    command: /speckit.specify [feature-description]
    outputs:
      - feature_branch: created
      - spec.md: acceptance_criteria
      - location: specs/[NNN-feature]/spec.md
    optional_documents:
      - research-spike-[name].md: "Time-boxed research/experimentation BEFORE implementation (copy from .opencode/speckit/templates/research_spike_template.md)"
      - decision-record-[name].md: "Architecture Decision Records for significant technical choices (copy from .opencode/speckit/templates/decision_record_template.md)"
    validation: spec_complete
    chrome_devtools:
      when: analyzing_existing_features
      approach: Navigate → Snapshot → Analyze → Document
    deep_analysis:
      focus: comprehensive_specification
      approach: rigorous_requirements_definition
      outputs:
        - feature_scope_definition
        - acceptance_criteria
        - technical_constraints
        - dependency_identification
        - edge_case_analysis
        - success_metrics
    checkpoint:
      display:
        step_summary: "Feature specification created with acceptance criteria"
        outputs_generated:
          - "spec.md with user stories"
          - "Acceptance criteria defined"
          - "Feature branch created"
        key_decisions: "Feature scope and success metrics"
        issues_found: "Any ambiguities or concerns identified"
      question:
        prompt: "Step 3 complete: Specification. How would you like to proceed?"
        options:
          - label: "Approve and continue to Clarification"
            action: proceed_to_step_4
          - label: "Edit spec.md"
            action: edit_specification
          - label: "Add research spike document"
            action: create_research_spike
          - label: "Review spec in detail"
            action: display_spec_content

  step_4_clarification:
    command: /speckit.clarify
    outputs:
      - resolved_ambiguities
      - clarified_requirements
      - updated_spec
    validation: requirements_clear
    chrome_devtools:
      when: staging_url_provided
      approach: Navigate → Inspect → Analyze → Clarify
      capture: current_behavior_screenshots
    spike_option:
      command: /speckit.research-spike [research-question]
      when: technical_uncertainty_requires_investigation
      note: "Use for time-boxed research before committing to approach"
    deep_analysis:
      focus: ambiguity_resolution
      approach: systematic_clarification
      outputs:
        - requirement_refinement
        - constraint_validation
        - assumption_documentation
        - risk_identification
    checkpoint:
      display:
        step_summary: "Ambiguities resolved and requirements clarified"
        outputs_generated:
          - "Resolved ambiguity list"
          - "Updated spec.md"
          - "Clarification notes"
        key_decisions: "Resolved requirement uncertainties"
      question:
        prompt: "Step 4 complete: Clarification. How would you like to proceed?"
        options:
          - label: "Approve and continue to Quality Checklist"
            action: proceed_to_step_5
          - label: "Continue clarification"
            action: additional_clarification
          - label: "Review changes to spec"
            action: display_spec_changes
          - label: "Create research spike"
            action: create_research_spike

  step_5_quality_checklist:
    command: /speckit.checklist
    outputs:
      - quality_checklist: generated
    validation: checklist_generated
    deep_analysis:
      focus: quality_validation_preparation
      approach: comprehensive_checklist_design
      outputs:
        - validation_criteria
        - testing_requirements
        - quality_gates
    checkpoint:
      display:
        step_summary: "Quality checklist generated for validation"
        outputs_generated:
          - "checklist.md with validation criteria"
          - "Testing requirements documented"
          - "Quality gates defined"
        key_decisions: "Validation approach and criteria"
      question:
        prompt: "Step 5 complete: Quality Checklist. How would you like to proceed?"
        options:
          - label: "Approve and continue to Planning"
            action: proceed_to_step_6
          - label: "Modify checklist"
            action: edit_checklist
          - label: "Review checklist in detail"
            action: display_checklist_content
          - label: "Skip to specific step"
            action: skip_to_step

  step_6_planning:
    command: /speckit.plan [context]
    outputs:
      - plan.md: technical_approach
      - dependencies: identified
      - upstream_docs: reviewed
    optional_documents:
      - tasks.md: "Implementation task breakdown AFTER plan.md, BEFORE coding (copy from .opencode/speckit/templates/tasks_template.md)"
      - checklist.md: "Validation & QA checklists when systematic validation needed (copy from .opencode/speckit/templates/checklist_template.md)"
    decision_records:
      command: /speckit.decision [decision-context]
      when: significant_technical_decision_needs_documentation
      note: "Document architecture decisions with full context and alternatives"
    validation: approach_defined
    chrome_devtools:
      when: analyzing_current_implementation
      actions:
        - inspect_network_requests
        - analyze_dom_structure
        - review_console_errors
        - capture_performance_metrics
    deep_analysis:
      focus: technical_architecture_design
      approach: comprehensive_planning
      outputs:
        - implementation_strategy
        - technical_approach
        - dependency_analysis
        - integration_patterns
        - risk_mitigation
        - rollback_strategy
    checkpoint:
      display:
        step_summary: "Technical plan created with implementation approach"
        outputs_generated:
          - "plan.md with technical approach"
          - "Dependencies identified"
          - "Risk mitigation strategies"
        key_decisions: "Architecture and implementation strategy"
      question:
        prompt: "Step 6 complete: Planning. How would you like to proceed?"
        options:
          - label: "Approve and continue to Task Breakdown"
            action: proceed_to_step_7
          - label: "Edit plan.md"
            action: edit_plan
          - label: "Add decision record"
            action: create_decision_record
          - label: "Review plan in detail"
            action: display_plan_content

  step_7_task_breakdown:
    command: /speckit.tasks
    outputs:
      - tasks/checklist.md
    optional_documents:
      - checklist.md: "Validation & QA checklists if not already created (copy from .opencode/speckit/templates/checklist_template.md)"
    validation: tasks_documented
    deep_analysis:
      focus: implementation_task_design
      approach: systematic_breakdown
      outputs:
        - task_prioritization
        - dependency_ordering
        - validation_checkpoints
        - incremental_milestones
    checkpoint:
      display:
        step_summary: "Implementation tasks documented and prioritized"
        outputs_generated:
          - "tasks.md with task breakdown"
          - "Task priorities assigned"
          - "Dependencies mapped"
        key_decisions: "Implementation order and milestones"
      question:
        prompt: "Step 7 complete: Task Breakdown. How would you like to proceed?"
        options:
          - label: "Approve and continue to Analysis"
            action: proceed_to_step_8
          - label: "Modify tasks"
            action: edit_tasks
          - label: "Review task breakdown"
            action: display_tasks_content
          - label: "Skip to specific step"
            action: skip_to_step

  step_8_analysis:
    command: /speckit.analyze
    outputs:
      - consistency_report
      - coverage_verification
      - alignment_check
      - gap_analysis
    validation: consistency_verified
    chrome_devtools:
      when: comparing_staging_vs_spec
      approach: Navigate → Snapshot → Compare → Report
      focus:
        - ui_consistency
        - functionality_gaps
        - performance_baseline
    deep_analysis:
      focus: comprehensive_codebase_analysis
      approach: systematic_investigation
      outputs:
        - current_state_assessment
        - gap_identification
        - consistency_verification
        - integration_points
        - existing_patterns
    checkpoint:
      display:
        step_summary: "Consistency analysis complete across all artifacts"
        outputs_generated:
          - "Consistency report"
          - "Coverage verification"
          - "Gap analysis"
        key_decisions: "Issues to address before implementation"
        issues_found: "Inconsistencies or gaps detected"
      question:
        prompt: "Step 8 complete: Analysis. How would you like to proceed?"
        options:
          - label: "Approve and continue to Implementation Check"
            action: proceed_to_step_9
          - label: "Fix identified issues"
            action: fix_analysis_issues
          - label: "Review analysis report"
            action: display_analysis_report
          - label: "Go back to previous step"
            action: go_back

  step_9_implementation_check:
    command: /speckit.implement [task-id]
    checks:
      prerequisites: verified
      blockers: none
      environment: ready
    chrome_devtools:
      when: validating_environment
      verify:
        - api_endpoints_accessible
        - authentication_working
        - dependencies_loaded
    deep_analysis:
      focus: implementation_readiness
      approach: comprehensive_validation
      outputs:
        - environment_verification
        - dependency_confirmation
        - blocker_resolution
        - implementation_greenlight
    checkpoint:
      display:
        step_summary: "Implementation prerequisites verified"
        outputs_generated:
          - "Environment verification complete"
          - "Dependencies confirmed"
          - "No blockers identified"
        key_decisions: "Ready to begin development"
      question:
        prompt: "Step 9 complete: Implementation Check. Ready to start development?"
        options:
          - label: "Approve and start Development"
            action: proceed_to_step_10
          - label: "Resolve blockers first"
            action: resolve_blockers
          - label: "Review prerequisites"
            action: display_prerequisites
          - label: "Skip to specific step"
            action: skip_to_step

  step_10_development:
    approach: implementation_with_checkpoints
    requirements:
      - follow: .claude/knowledge/code_standards.md
      - update: task_checklist_progressively
      - test: before_commit
      - validate: continuously
    checkpoints:
      major_changes:
        action: log_progress
        validation: user_approval
      issues_found:
        action: document_resolution
        validation: verify_fix
      architecture_change:
        action: note_deviation
        validation: verify_alignment
    chrome_devtools:
      when: debugging_implementation
      actions:
        - test_in_browser
        - verify_network_calls
        - check_console_output
        - validate_dom_changes
        - measure_performance_impact
    deep_analysis:
      focus: implementation_execution
      approach: iterative_development_with_validation
      outputs:
        - code_implementation
        - test_validation
        - progressive_verification
        - quality_assurance
        - deviation_documentation
    checkpoint:
      display:
        step_summary: "Implementation complete"
        outputs_generated:
          - "Code changes implemented"
          - "Tests written/passing"
          - "Browser validation complete"
        key_decisions: "Implementation choices and any deviations"
        issues_found: "Any issues encountered during development"
      question:
        prompt: "Step 10 complete: Development. How would you like to proceed?"
        options:
          - label: "Approve and continue to Completion Summary"
            action: proceed_to_step_11
          - label: "Continue implementation"
            action: continue_development
          - label: "Review changes made"
            action: display_changes_summary
          - label: "Run additional tests"
            action: run_tests

  step_11_completion:
    summary_document:
      location: specs/[NNN-feature]/implementation-summary.md
      required_sections:
        - feature_branch_name
        - files_modified_created
        - verification_steps_taken
        - deviations_from_plan
        - knowledge_base_updates
        - recommended_next_steps
        - browser_testing_results
    final_checklist:
      - update_task_status: completed
      - validation_passed: confirmed
      - summary_created: true
      - staging_verified: true
    deep_analysis:
      focus: completion_documentation
      approach: comprehensive_summary
      outputs:
        - implementation_summary
        - change_documentation
        - validation_results
        - next_steps_recommendation
    validation: implementation_complete
    checkpoint:
      display:
        step_summary: "Implementation summary document created"
        outputs_generated:
          - "implementation-summary.md"
          - "All tasks marked complete"
          - "Staging verification done"
        key_decisions: "Final documentation and next steps"
      question:
        prompt: "Step 11 complete: Completion Summary. How would you like to proceed?"
        options:
          - label: "Approve and save context"
            action: proceed_to_step_12
          - label: "Edit summary document"
            action: edit_summary
          - label: "Review all documentation"
            action: review_all_docs
          - label: "Add additional notes"
            action: add_notes

  step_12_save_context:
    action: Save conversation context for documentation and team sharing
    invocation: Skill(skill: "save-context")
    description: |
      Preserve comprehensive conversation context including:
      - Session metadata and timeline
      - Full dialogue flow with decisions
      - Auto-generated workflow flowcharts
      - File changes and implementation details
    outputs:
      - context_file: specs/[NNN-feature]/memory/[DD-MM-YY_HH-MM]__session.md
      - workflow_flowchart: auto_generated
      - decision_documentation: preserved
    validation: context_saved_successfully
    checkpoint:
      display:
        step_summary: "Conversation context saved for team reference"
        outputs_generated:
          - "Context file in memory/"
          - "Workflow flowchart"
          - "Decision documentation"
        key_decisions: "Complete implementation record preserved"
      question:
        prompt: "Step 12 complete: Context Saved. Workflow finished!"
        options:
          - label: "Finish and close workflow"
            action: complete_workflow
          - label: "Review all artifacts created"
            action: review_all_artifacts
          - label: "Generate additional documentation"
            action: generate_docs

termination:
  after_step: 12
  message: "SpecKit workflow completed successfully with user approval at all checkpoints."

# ─────────────────────────────────────────────────────────────────
# QUALITY STANDARDS
# ─────────────────────────────────────────────────────────────────
quality_standards:
  documentation:
    - production_ready_examples
    - defensive_programming_patterns
    - error_handling_strategies
    - comprehensive_test_coverage
  code_examples:
    - working_snippets
    - proper_error_handling
    - performance_optimized
    - accessibility_compliant
    - browser_compatible
  analysis_depth:
    - edge_cases_covered
    - failure_modes_documented
    - recovery_strategies_defined
    - monitoring_approaches_specified

# ─────────────────────────────────────────────────────────────────
# INTERACTIVE EXECUTION GUIDANCE
# ─────────────────────────────────────────────────────────────────
interactive_execution:
  principle: "Execute workflow steps with user confirmation at each checkpoint"

  checkpoint_behavior:
    - Present step summary with outputs
    - Show key decisions made
    - List any issues found
    - Offer multiple choice options
    - Wait for user selection before proceeding

  user_options:
    standard:
      - approve_and_continue
      - review_outputs
      - modify_approach
      - skip_to_step
      - abort_workflow

  decision_making:
    - Analyze requirements thoroughly
    - Present options to user
    - Document user decisions
    - Proceed based on user choice
    - Log all significant decisions

  validation_approach:
    - Validate at each checkpoint
    - Present validation results
    - Get user approval before proceeding
    - Document validation outcomes
    - Ensure quality standards met

# ─────────────────────────────────────────────────────────────────
# RULES
# ─────────────────────────────────────────────────────────────────
rules:
  ALWAYS:
    - follow_workflow_sequence
    - document_all_changes
    - validate_before_completion
    - use_devtools_for_staging_analysis
    - prompt_for_user_approval_at_checkpoints
    - present_options_clearly
    - wait_for_user_decision
    - log_decisions_and_deviations

  NEVER:
    - skip_workflow_steps
    - ignore_blockers
    - submit_without_validation
    - skip_browser_testing
    - proceed_without_user_approval
    - over_engineer_or_expand_scope
    - break_existing_functionality

  VALIDATION_REQUIRED:
    - Before moving to next step
    - After each code change
    - Before committing changes
    - After browser testing
    - At completion summary
    - User approval at each checkpoint

# ─────────────────────────────────────────────────────────────────
# SUCCESS CRITERIA
# ─────────────────────────────────────────────────────────────────
success:
  specification:
    - Requirements clearly defined
    - Acceptance criteria documented
    - Technical approach planned
    - Dependencies identified
    - User approved at checkpoint

  implementation:
    - Code follows standards
    - Tests pass
    - Browser validation complete
    - Performance acceptable
    - User approved at checkpoint

  documentation:
    - Spec folder complete
    - Implementation summary created
    - Deviations documented
    - Context saved
    - User approved at checkpoint

  quality:
    - Checklist validated
    - No regressions introduced
    - Functionality preserved
    - Standards maintained
    - User approved at checkpoint
