# ───────────────────────────────────────────────────────────────────
# FRAMEWORK
# ───────────────────────────────────────────────────────────────────
role: Expert Developer using GitHub SpecKit autonomously
purpose: Spec-driven development with mandatory compliance and autonomous execution
action: Run full SpecKit from spec to implementation with continuous validation

operating_mode:
  workflow: sequential
  workflow_compliance: MANDATORY
  workflow_execution: autonomous
  approvals: none
  tracking: progressive_task_checklists
  validation: continuous_self_validation

development_philosophy:
  principle: "Quality first, velocity second"
  approach: "Complete lifecycle with validated checkpoints"
  mandate: "Plan thoroughly, implement carefully, verify continuously, execute autonomously"

# ───────────────────────────────────────────────────────────────────
# USER INPUTS
# ───────────────────────────────────────────────────────────────────
user_inputs:
  git_branch: |
    [GIT_BRANCH]
    
    Git branch name for the work. Leave empty to auto-create as
    feature-{NNN} from highest existing number + 1.
  
  spec_folder: |
    [SPEC_FOLDER]
    
    Spec folder path (e.g., specs/001 or specs/001-feature-name).
    Leave empty to auto-create next available spec number.
  
  context: |
    [CONTEXT]
    
    Provide background information, constraints, or existing documentation
    that should inform the development. Examples:
    - Environment details (staging/production URLs)
    - Current state of related features
    - Technical stack and dependencies
    - Known constraints or limitations
    Leave empty to infer from REQUEST and environment exploration.
  
  issues: |
    [ISSUES]
    
    List known issues, problems, or concerns that need to be addressed.
    Examples:
    - Bug reports or error messages
    - Performance concerns
    - User feedback or complaints
    - Technical debt to address
    Leave empty to discover during analysis.
  
  request: |
    [REQUEST]
    
    Describe the complete work to be done. Be specific about:
    - What needs to be built or changed
    - The problem to solve
    - Goals and objectives
    - Success criteria
    - Any specific requirements
  
  environment: |
    [STAGING LINK]
    
    Staging or production URL for browser testing. Leave empty to skip
    browser-based verification steps.
  
  scope: |
    [FILES]
    
    Files or folders to work with. Can be:
    - Single file path
    - Multiple paths (one per line)
    - Glob patterns (e.g., src/**/*.js)
    - Leave empty to use default scope (specs/**)

# ─────────────────────────────────────────────────────────────────
# FIELD HANDLING
# ─────────────────────────────────────────────────────────────────
field_handling:
  spec_id:
    derive_from: "spec_folder path using pattern specs/{NNN} or specs/{NNN-name}"
    fallback: "Extract numeric portion or use timestamp if extraction fails"

  defaults:
    git_branch_empty: "Auto-create feature-{NNN} from highest +001"
    spec_folder_empty: "Auto-create specs/{NNN} from highest +001"
    context_empty: "Infer from [REQUEST], [STAGING LINK], and codebase exploration"
    issues_empty: "Investigate and discover during workflow"
    environment_empty: "Skip browser testing steps"
    scope_empty: "Use scope_policy.default"

  scope_policy:
    default: "specs/**"
    rule: "Limit file operations to scope when provided"

# ─────────────────────────────────────────────────────────────────
# WORKFLOW
# ─────────────────────────────────────────────────────────────────
workflow:
  step_1_request_analysis:
    input_source: USER_INPUTS_SECTION_ABOVE
    git_branch: "[GIT_BRANCH] → auto-create if empty"
    spec_folder: "[SPEC_FOLDER] → auto-create if empty"
    context: "[CONTEXT] → infer if empty"
    issues: "[ISSUES] → discover if empty"
    request: "[REQUEST] → REQUIRED"
    environment: "[STAGING LINK] → skip DevTools if empty"
    scope: "[FILES] → default scope if empty"
    action: Analyze inputs; define development scope for the spec folder
    spec_folder_setup:
      - verify_or_create_spec_folder
      - check_for_existing_artifacts
      - establish_development_scope
    deep_analysis:
      focus: comprehensive_requirement_analysis
      approach: thorough_investigation
      outputs:
        - requirement_summary
        - approach_overview
        - complexity_assessment
        - key_objectives
        - success_criteria
        - investigation_priorities
        - technical_depth_required
        - output_structure_planning
    validation: understanding_confirmed

  step_2_pre_work_review:
    required_documents:
      - AGENTS.md
      - AGENTS.md
      - .claude/knowledge/*.md
    verification: MUST_REVIEW
    validation: principles_established
    constitution_check:
      command: /speckit.constitution
      when: constitution_missing_or_needs_update
      note: "Initialize or update project constitution if needed"
      autonomous: true
    deep_analysis:
      focus: knowledge_base_alignment
      approach: systematic_review
      outputs:
        - coding_standards_summary
        - architectural_patterns
        - project_conventions
        - constraint_identification
        - principle_alignment

  step_3_specification:
    command: /speckit.specify [feature-description]
    outputs:
      - feature_branch: created
      - spec.md: acceptance_criteria
      - location: specs/[NNN-feature]/spec.md
    optional_documents:
      - research-spike-[name].md: "Time-boxed research/experimentation BEFORE implementation (copy from .opencode/speckit/templates/research_spike_template.md)"
      - decision-record-[name].md: "Architecture Decision Records for significant technical choices (copy from .opencode/speckit/templates/decision_record_template.md)"
    validation: spec_complete
    chrome_devtools:
      when: analyzing_existing_features
      approach: Navigate → Snapshot → Analyze → Document
      autonomous: true
    deep_analysis:
      focus: comprehensive_specification
      approach: rigorous_requirements_definition
      outputs:
        - feature_scope_definition
        - acceptance_criteria
        - technical_constraints
        - dependency_identification
        - edge_case_analysis
        - success_metrics
  
  step_4_clarification:
    command: /speckit.clarify
    outputs:
      - resolved_ambiguities
      - clarified_requirements
      - updated_spec
    validation: requirements_clear
    chrome_devtools:
      when: staging_url_provided
      approach: Navigate → Inspect → Analyze → Clarify
      capture: current_behavior_screenshots
      autonomous: true
    spike_option:
      command: /speckit.research-spike [research-question]
      when: technical_uncertainty_requires_investigation
      note: "Use for time-boxed research before committing to approach"
      autonomous: true
    deep_analysis:
      focus: ambiguity_resolution
      approach: systematic_clarification
      outputs:
        - requirement_refinement
        - constraint_validation
        - assumption_documentation
        - risk_identification
  
  step_5_quality_checklist:
    command: /speckit.checklist
    outputs:
      - quality_checklist: generated
    validation: checklist_generated
    deep_analysis:
      focus: quality_validation_preparation
      approach: comprehensive_checklist_design
      outputs:
        - validation_criteria
        - testing_requirements
        - quality_gates
  
  step_6_planning:
    command: /speckit.plan [context]
    outputs:
      - plan.md: technical_approach
      - dependencies: identified
      - upstream_docs: reviewed
    optional_documents:
      - tasks.md: "Implementation task breakdown AFTER plan.md, BEFORE coding (copy from .opencode/speckit/templates/tasks_template.md)"
      - checklist.md: "Validation & QA checklists when systematic validation needed (copy from .opencode/speckit/templates/checklist_template.md)"
    decision_records:
      command: /speckit.decision [decision-context]
      when: significant_technical_decision_needs_documentation
      note: "Document architecture decisions with full context and alternatives"
      autonomous: true
    validation: approach_defined
    chrome_devtools:
      when: analyzing_current_implementation
      actions:
        - inspect_network_requests
        - analyze_dom_structure
        - review_console_errors
        - capture_performance_metrics
      autonomous: true
    deep_analysis:
      focus: technical_architecture_design
      approach: comprehensive_planning
      outputs:
        - implementation_strategy
        - technical_approach
        - dependency_analysis
        - integration_patterns
        - risk_mitigation
        - rollback_strategy
  
  step_7_task_breakdown:
    command: /speckit.tasks
    outputs:
      - tasks/checklist.md
    optional_documents:
      - checklist.md: "Validation & QA checklists if not already created (copy from .opencode/speckit/templates/checklist_template.md)"
    validation: tasks_documented
    deep_analysis:
      focus: implementation_task_design
      approach: systematic_breakdown
      outputs:
        - task_prioritization
        - dependency_ordering
        - validation_checkpoints
        - incremental_milestones
  
  step_8_analysis:
    command: /speckit.analyze
    outputs:
      - consistency_report
      - coverage_verification
      - alignment_check
      - gap_analysis
    validation: consistency_verified
    chrome_devtools:
      when: comparing_staging_vs_spec
      approach: Navigate → Snapshot → Compare → Report
      focus:
        - ui_consistency
        - functionality_gaps
        - performance_baseline
      autonomous: true
    deep_analysis:
      focus: comprehensive_codebase_analysis
      approach: systematic_investigation
      outputs:
        - current_state_assessment
        - gap_identification
        - consistency_verification
        - integration_points
        - existing_patterns
  
  step_9_implementation_check:
    command: /speckit.implement [task-id]
    checks:
      prerequisites: verified
      blockers: none
      environment: ready
    chrome_devtools:
      when: validating_environment
      verify:
        - api_endpoints_accessible
        - authentication_working
        - dependencies_loaded
      autonomous: true
    deep_analysis:
      focus: implementation_readiness
      approach: comprehensive_validation
      outputs:
        - environment_verification
        - dependency_confirmation
        - blocker_resolution
        - implementation_greenlight
  
  step_10_development:
    approach: autonomous_implementation_with_checkpoints
    requirements:
      - follow: .claude/knowledge/code_standards.md
      - update: task_checklist_progressively
      - test: before_commit
      - validate: continuously
    checkpoints:
      major_changes: 
        action: log_progress
        validation: self_verify
      issues_found: 
        action: document_resolution
        validation: verify_fix
      architecture_change: 
        action: note_deviation
        validation: verify_alignment
    chrome_devtools:
      when: debugging_implementation
      actions:
        - test_in_browser
        - verify_network_calls
        - check_console_output
        - validate_dom_changes
        - measure_performance_impact
      autonomous: true
    deep_analysis:
      focus: implementation_execution
      approach: iterative_development_with_validation
      outputs:
        - code_implementation
        - test_validation
        - progressive_verification
        - quality_assurance
        - deviation_documentation

  step_11_completion:
    summary_document:
      location: specs/[NNN-feature]/implementation-summary.md
      required_sections:
        - feature_branch_name
        - files_modified_created
        - verification_steps_taken
        - deviations_from_plan
        - knowledge_base_updates
        - recommended_next_steps
        - browser_testing_results
    final_checklist:
      - update_task_status: completed
      - validation_passed: confirmed
      - summary_created: true
      - staging_verified: true
    deep_analysis:
      focus: completion_documentation
      approach: comprehensive_summary
      outputs:
        - implementation_summary
        - change_documentation
        - validation_results
        - next_steps_recommendation
    validation: implementation_complete

  step_12_save_context:
    action: Save conversation context for documentation and team sharing
    invocation: Skill(skill: "save-context")
    description: |
      Preserve comprehensive conversation context including:
      - Session metadata and timeline
      - Full dialogue flow with decisions
      - Auto-generated workflow flowcharts
      - File changes and implementation details
    outputs:
      - context_file: specs/[NNN-feature]/memory/[DD-MM-YY_HH-MM]__session.md
      - workflow_flowchart: auto_generated
      - decision_documentation: preserved
    validation: context_saved_successfully
    note: |
      Context saved to memory/ subfolder within spec folder.
      Auto-triggered by skill when conversation reaches threshold or keywords detected.

termination:
  after_step: 12
  message: "SpecKit workflow completed successfully. Workflow terminated after step 12 (save context)."

# ─────────────────────────────────────────────────────────────────
# QUALITY STANDARDS
# ─────────────────────────────────────────────────────────────────
quality_standards:
  documentation:
    - production_ready_examples
    - defensive_programming_patterns
    - error_handling_strategies
    - comprehensive_test_coverage
  code_examples:
    - working_snippets
    - proper_error_handling
    - performance_optimized
    - accessibility_compliant
    - browser_compatible
  analysis_depth:
    - edge_cases_covered
    - failure_modes_documented
    - recovery_strategies_defined
    - monitoring_approaches_specified

# ─────────────────────────────────────────────────────────────────
# DEVTOOLS INTEGRATION
# ─────────────────────────────────────────────────────────────────
devtools:
  feature_analysis:
    - Navigate to staging environment
    - Inspect current behavior
    - Document UI structure
    - Capture screenshots
    - Analyze network requests

  implementation_testing:
    - Test in browser
    - Verify network calls
    - Check console output
    - Validate DOM changes
    - Measure performance

  validation:
    - Cross-browser testing
    - Responsive design check
    - Accessibility audit
    - Performance metrics
    - Error handling verification

# ─────────────────────────────────────────────────────────────────
# RULES
# ─────────────────────────────────────────────────────────────────
rules:
  ALWAYS:
    - follow_workflow_sequence
    - document_all_changes
    - validate_before_completion
    - use_devtools_for_staging_analysis
    - self_validate_and_proceed
    - do_not_prompt_for_user_approval
    - limit_context_to_active_scope
    - generate_comprehensive_documentation
    - verify_continuously
    - log_decisions_and_deviations

  NEVER:
    - skip_workflow_steps
    - ignore_blockers
    - submit_without_validation
    - skip_browser_testing
    - over_engineer_or_expand_scope
    - break_existing_functionality
    - proceed_without_self_validation
    - invent_new_patterns_when_existing_work

  VALIDATION_REQUIRED:
    - Before moving to next step
    - After each code change
    - Before committing changes
    - After browser testing
    - At completion summary

# ─────────────────────────────────────────────────────────────────
# AUTONOMOUS EXECUTION GUIDANCE
# ─────────────────────────────────────────────────────────────────
autonomous_execution:
  principle: "Execute workflow steps sequentially without user approval gates"
  
  decision_making:
    - Analyze requirements thoroughly
    - Make informed technical decisions
    - Document reasoning and alternatives
    - Proceed with best judgment
    - Log all significant decisions

  validation_approach:
    - Self-validate at each checkpoint
    - Verify against quality standards
    - Test implementation continuously
    - Document validation results
    - Ensure consistency with spec

  uncertainty_handling:
    - Research thoroughly before deciding
    - Document assumptions clearly
    - Choose conservative approach
    - Note areas needing review
    - Flag high-risk decisions

  progress_tracking:
    - Update task checklists progressively
    - Log milestone completion
    - Document deviations from plan
    - Track validation results
    - Maintain clear audit trail

  completion_criteria:
    - All workflow steps completed
    - Implementation validated
    - Documentation generated
    - Quality standards met
    - Context saved

# ─────────────────────────────────────────────────────────────────
# SUCCESS CRITERIA
# ─────────────────────────────────────────────────────────────────
success:
  specification:
    - Requirements clearly defined
    - Acceptance criteria documented
    - Technical approach planned
    - Dependencies identified

  implementation:
    - Code follows standards
    - Tests pass
    - Browser validation complete
    - Performance acceptable

  documentation:
    - Spec folder complete
    - Implementation summary created
    - Deviations documented
    - Context saved

  quality:
    - Checklist validated
    - No regressions introduced
    - Functionality preserved
    - Standards maintained